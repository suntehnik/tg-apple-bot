# Тесты для Telegram Бота Отслеживания Питания

Этот каталог содержит тесты для проверки функциональности Telegram бота для отслеживания питания.

## Типы тестов

### Модульные тесты

- `test_config.py` - тестирование модуля конфигурации
- `test_dto.py` - тестирование моделей данных (DTO)

### Интеграционные тесты

- `integration_test_openai.py` - тест интеграции с OpenAI Vision API для анализа изображений еды
- `test_openai_integration.py` - дополнительный тест для OpenAI Vision API с использованием pytest

## Запуск тестов

### Запуск всех тестов

```bash
python -m pytest
```

### Запуск определенного теста

```bash
python -m pytest tests/test_config.py
```

### Запуск интеграционного теста OpenAI

```bash
# Вариант 1: Запуск скрипта напрямую
python tests/integration_test_openai.py

# Вариант 2: Запуск через pytest
python -m pytest tests/test_openai_integration.py
```

## Подготовка тестовых данных

### Тестовые изображения

Тесты OpenAI Vision API используют тестовые изображения из директории `tests/img/`. Изображения должны быть в формате PNG:

- `pizza.png` - изображение пиццы
- `salad.png` - изображение салата
- `burger.png` - изображение бургера

См. `tests/img/README.md` для получения подробной информации о тестовых изображениях.

## Настройка для интеграционных тестов

### OpenAI Vision API

Для запуска тестов с настоящим OpenAI Vision API необходимо:

1. Иметь аккаунт OpenAI с доступом к API
2. Получить API ключ
3. Установить переменную окружения `OPENAI_API_KEY`:

```bash
export OPENAI_API_KEY=your_api_key
```

Без настройки API ключа тесты будут использовать моковые ответы.

## Мокирование

В тестах используются мокирования для имитации внешних сервисов:

- OpenAI Vision API - мокирование ответов с информацией о еде
- Telegram API - мокирование взаимодействия с пользователем
- Firestore - мокирование базы данных

## Написание новых тестов

При добавлении новой функциональности рекомендуется:

1. Добавить модульные тесты для новых компонентов
2. Обновить интеграционные тесты для проверки работы компонентов вместе
3. Использовать фикстуры из `conftest.py` для общего кода

## Непрерывная интеграция

Тесты автоматически запускаются при создании pull request или при пуше в главную ветку с помощью CI/CD системы.